% !TeX root = text.tex
\documentclass{template/socthesis}

\usepackage{subcaption}
\usepackage{amsmath}
\usepackage{enumitem}

% my~own~code
\usepackage{xkvltxp}

\usepackage[skip=10pt plus1pt, indent=0pt]{parskip}
\usepackage[czech]{babel}
\usepackage{float}
\usepackage{geometry}
\usepackage{gensymb}
\usepackage{amssymb}
\usepackage[T1]{fontenc}
\usepackage[utf8]{inputenc}
\usepackage[newfloat]{minted}
\setmintedinline{breaklines}
\usepackage{pdfpages}

\usepackage{subcaption}
\usepackage{caption}

\usepackage[pages=some]{background}
\backgroundsetup{
  scale=1,
  angle=0,
  opacity=1,
  color=black,
  contents={%
    \includegraphics[width=\paperwidth,height=\paperheight]{img/pcb-schem-full.jpg}
  }
}

\usepackage[author=,status=final]{fixme}
\makeatletter
\renewcommand*\FXLayoutInline[3]{%
  {\@fxuseface{inline}\ignorespaces[#2]}}
\makeatother

\usepackage{caption}
\DeclareCaptionType{equ}[Rovnice][Seznam rovnic]
%\captionsetup[equ]{labelformat=empty}

\widowpenalty=10000
\clubpenalty=10000
\brokenpenalty=5000

%%%%%% podbarvení bloků kódu / vygenerovaných ai
\usepackage{xcolor}
\usepackage{listings}
\usepackage{tcolorbox}

\renewcommand\listingname{Ukázka kódu}

\newenvironment{code}{\captionsetup{type=listing}}{}
\SetupFloatingEnvironment{listing}{name=Ukázka kódu}

\tcbuselibrary{breakable}

\definecolor{aiblue}{rgb}{127,127,255}
\definecolor{aibackground}{rgb}{100,100,100}

\lstdefinestyle{aistyle}{
    backgroundcolor=\color{aibackground},   
    commentstyle=\color{aiblue},
    keywordstyle=\color{aiblue},
    numberstyle=\tiny\color{aiblue},
    stringstyle=\color{aiblue},
    basicstyle=\ttfamily\footnotesize,
    breakatwhitespace=false,         
    breaklines=true,                 
    captionpos=b,                    
    keepspaces=true,                 
    numbers=left,                    
    numbersep=5pt,                  
    showspaces=false,                
    showstringspaces=false,
    showtabs=false,                  
    tabsize=2
}

% https://tex.stackexchange.com/questions/24528/having-problems-with-listings-and-utf-8-can-it-be-fixed
\lstset{style=aistyle,
inputencoding=utf8,
extendedchars=true,
literate=%
{á}{{\'a}}1
{č}{{\v{c}}}1
{ď}{{\v{d}}}1
{é}{{\'e}}1
{ě}{{\v{e}}}1
{í}{{\'{\i}}}1
{ň}{{\v{n}}}1
{ó}{{\'o}}1
{ř}{{\v{r}}}1
{š}{{\v{s}}}1
{ť}{{\v{t}}}1
{ú}{{\'u}}1
{ů}{{\r{u}}}1
{ý}{{\'y}}1
{ž}{{\v{z}}}1
{Á}{{\'A}}1
{Č}{{\v{C}}}1
{Ď}{{\v{D}}}1
{É}{{\'E}}1
{Ě}{{\v{E}}}1
{Í}{{\'I}}1
{Ň}{{\v{N}}}1
{Ó}{{\'O}}1
{Ř}{{\v{R}}}1
{Š}{{\v{S}}}1
{Ť}{{\v{T}}}1
{Ú}{{\'U}}1
{Ů}{{\r{U}}}1
{Ý}{{\'Y}}1
{Ž}{{\v{Z}}}1
}

\DeclareUnicodeCharacter{2212}{\textminus}% requires a~unicode capable editor

\addbibresource{text.bib}

\titlecz{RGB Laserový projektor}
\titleen{RGB Laser projector}
\author{Šimon Hrouda}
\field{10}
\school{Gymnázium Brno-Řečkovice, p.~o., Terezy Novákové 2, 621 00 Brno}
\mentor{Tomáš Rohlínek a~Mgr.~Kateřina Vídenková}
\mentorstatement{Tomáše Rohlínka a~Mgr.~Kateřiny Vídenkové}


% Změňte, pokud se~liší
%\region{Jihomoravský}
\placefooter{Brno 2024}

\begin{document}
% \newcommand{\bard-gen}[3]{text vygenerován ai~#1}
\newcommand{\bardgen}[3]{following text generated by~ai~(google bard) on~#1\\%
  \begin{tcolorbox}[breakable, colback=blue!20]
    #2
  \end{tcolorbox}
  \begin{tcolorbox}[breakable, colback=blue!10, colframe=white]
    #3
  \end{tcolorbox}
}


\maketitle

\makecopyrightstatement{V~Brně}

\makethanks{Děkuji svým konzultantům Tomáši Rohlínkovi a~Mgr. Kateřině Vídenkové za~obětavou pomoc, podnětné připomínky a~nekonečnou trpělivost, kterou mi~během práce poskytovali.}

\pagestyle{empty}

\section*{Anotace}

Tato práce se zabývá konstrukcí laserového projektoru a jeho programovým výbavením.
Cílem práce je zviditelnění a zpřístupnění technologie laser scanningu zájemcům o~laserovou projekci.
Zpřístupnění spočívá v zapracování jednoduchého uživatelského prostředí do programového výbavení.

\subsection*{Klíčová slova}
Raspberry Pi; open-source; laser scanning; laserová projekce; galvanometr; JavaScript; C++; TCP socket; uživatelské prostředí

\vspace{20mm}

\section*{Annotation}
This thesis deals with the construction of a laser projector and with the software made for it.
The aim of this thesis is adding visibility to the laser scanning technology and making it accessible to interested hobbyists.

\subsection*{Keywords}
Raspberry Pi; open-source; laser scanning; laser projection; galvanometer; JavaScript; C++; TCP socket; user interface

\newpage

\addtocontents{toc}{\protect\thispagestyle{empty}}
\tableofcontents % vysází obsah
\pagestyle{empty}

%%% Začátek práce
\setcounter{figure}{0}
\setcounter{table}{0}

\newpage
\pagestyle{plain}

\input{00-uvod.tex}

% \input{100-uvod-teor.tex}

\input{101-laser_scanning.tex}

\input{102-laser_projection.tex}

% \input{103-laser_safety.tex}

\input{110-technologie.tex}


% \input{200-uvod-prak.tex}

\input{210-hardware.tex}

\input{220-software.tex}

\input{999-diskuze.tex}

\input{9999-zaver.tex}

\newpage
\printbibliography[title=Literatura]
\addcontentsline{toc}{chapter}{Literatura}

\listoffigures
\addcontentsline{toc}{chapter}{Seznam obrázků}

% \listoftables
% \addcontentsline{toc}{chapter}{Seznam tabulek}

% \listoflistedequation
% \addcontentsline{toc}{chapter}{Seznam rovnic}

% \renewcommand\lstlistlistingname{Seznam ukázek kódu}
% \addcontentsline{toc}{chapter}{Seznam ukázek kódu}
% \lstlistoflistings % Now~typeset the~list

% \chapter*{Přílohy}

% \newgeometry{top=0pt, bottom=0pt, left=0pt, right=0pt}

% přílohy - schem a ukazky kodu
% ma byt před tim nadpis?

\renewcommand\listingname{Ukázka kódu -- Příloha}

% \newenvironment{code}{\captionsetup{type=listing}}{}
\SetupFloatingEnvironment{listing}{name=Ukázka kódu -- Příloha}

\includepdf[pages=-]{img/pcb-schem-full.pdf}
\addcontentsline{toc}{chapter}{Přílohy}
\pagestyle{empty}
\setcounter{chapter}{7}
\setcounter{listing}{1}

% ukazky kodu
\begin{code}
  \captionof{listing}{\label{list:zmq_s_cpp} Využití knihovny cppzmq v~programu lasershow}
  \inputminted[frame=lines,fontsize=\footnotesize{}, linenos, breaklines]{cpp}{code_examples/zmq_server.cpp}
\end{code}

\begin{code}
  \captionof{listing}{\label{list:adcdac} Využití knihovny ADCDACPi v~programu lasershow}
  \inputminted[frame=lines,fontsize=\footnotesize{}, linenos, breaklines]{cpp}{code_examples/adcdac.cpp}
\end{code}

\begin{code}
  \captionof{listing}{\label{list:pigpio_pwm} Využití PWM~funkcí knihovny pigpio v~programu lasershow}
  \inputminted[frame=lines,fontsize=\footnotesize{}, linenos, breaklines]{cpp}{code_examples/pigpio_pwm.cpp}
\end{code}

\begin{code}
  \captionof{listing}{\label{list:zmq_s_js} Využití knihovny zeromq.js v~programu wifi\_manager}
  \inputminted[frame=lines,fontsize=\footnotesize{}, linenos, breaklines]{js}{code_examples/zmq_server.js}
\end{code}

\begin{code}
  \captionof{listing}{\label{list:soft_lcd} Využití knihovny wPi\_soft\_lcd v~programu UI~ke komunikaci s~LCD}
  \inputminted[frame=lines,fontsize=\footnotesize{}, linenos, breaklines]{cpp}{code_examples/soft_lcd.cpp}
\end{code}

\begin{code}
  \captionof{listing}{\label{list:wiringpi} Využití knihovny wiringPi v~programu UI~k registraci přerušení (interruptů)}
  \inputminted[frame=lines,fontsize=\footnotesize{}, linenos, breaklines]{cpp}{code_examples/wiringpi_isr.cpp}
\end{code}

\begin{code}
  \captionof{listing}{\label{list:zmq_c_cpp} Využití knihovny cppzmq v~programu UI}
  \inputminted[frame=lines,fontsize=\footnotesize{}, linenos, breaklines]{cpp}{code_examples/zmq_client.cpp}
\end{code}

\begin{code}
  \captionof{listing}{\label{list:menu_option} Definice struktury menu\_option v~programu UI}
  \begin{minted}[frame=lines,fontsize=\footnotesize,linenos, breaklines]{cpp}
template <typename T>
struct menu_val
{
  T num;
  T min;
  T max;
  T change_by = 1;
};

enum menu_option_style
{
  NESTED_MENU = 0,
  VALUE,
  SELECTION, // all childrem are style text, nest_selected is written to value after button is pressed
  TEXT,
  ROOT_MENU,
  UNDEFINED
};

struct menu_option
{
  std::string name; // Text zobrazený uživateli

  std::string command_name; // interní název položky pro komunikaci s backendovými programy

  menu_option_style style = UNDEFINED; // Typ položky; od něj se odvíjí přístup k položce

  std::vector<menu_option> nested_menu_options = {}; // Podpoložky této položky
  uint8_t nest_selected = 0; // Vybraná podpoložka
  uint8_t nest_scroll = 0; // Interní hodnota; Úrčuje které podpoložky mají zrovna být vykresleny
  bool nest_option_active = 0; // Úrčuje, jestli je zrovna vybraná podpoložka aktivní
  bool redraw = 0; // Vlajka indikující, zda má být obsah položky znovu vykreslen, například pokud se změnil

  menu_val<float> value; // hodnota položky, například u položek typu VALUE

  bool has_function = 0;
  void (*function)(zmq::socket_t &, menu_option &);
};
\end{minted}
\end{code}

\begin{code}
  \captionof{listing}{\label{list:menu_def} Příklad definice menu v programu UI}
  \begin{minted}[breaklines, frame=lines,fontsize=\footnotesize,linenos]{cpp}
menu_option root = {
  .name = "ROOT",
  .style = ROOT_MENU,
  .nested_menu_options = {
    {
    .name = "progress%",
    .command_name = "progress",
    .style = VALUE,
    .value = {0, 0, 100, 0.5},
  },
  {
    .name = "current_frame",
    .command_name = "current_frame",
    .style = VALUE,
    .value = {1, 1, 1, 1},
    },
    {
    .name = "-no out received-",
    .style = TEXT
  },
  {
    .name = "STOP",
    .command_name = "STOP",
    .style = TEXT,
    .has_function = 1,
    .function = send_option_command
  },
  {
    .name = "PAUSE",
    .command_name = "PAUSE",
    .style = TEXT,
    .has_function = 1,
    .function = send_option_command
    },
  {
    .name = "PROJECT",
    .style = NESTED_MENU,
    .has_function = 1,
    .function = fill_with_files,
  },
  {
    .name = "options",
    .style = NESTED_MENU,
    .nested_menu_options = {
        {
            .name = "screen brightness",
            .command_name = "screen_brightness",
            .style = VALUE,
            .value = {50, 0, 100},
        },
        {
            .name = "repeat",
            .command_name = "repeat",
            .style = VALUE,
            .value = {0, 0, 1, 1},
        },
        {
            .name = "point_delay",
            .command_name = "point_delay",
            .style = VALUE,
            .value = {0, 0, 10000, 10},
            },
            {
            .name = "target_frame_time",
            .command_name = "target_frame_time",
            .style = VALUE,
            .value = {0, 0, 10000, 1},
        },
        {
            .name = "trapezoid_horizontal",
            .command_name = "trapezoid_horizontal",
            .style = VALUE,
            .value = {0, -1.f, 1.f, 0.05},
        },
        {
            .name = "trapezoid_vertical",
            .command_name = "trapezoid_vertical",
            .style = VALUE,
            .value = {0, -1.f, 1.f, 0.05},
        },
    },
    .has_function = 1,
    .function = read_options,
  }}};
  \end{minted}
\end{code}

\begin{code}
  \captionof{listing}{\label{list:http} Příklad http serveru v~jazyce javascript s~knihovnou http}
  \inputminted[frame=lines,fontsize=\footnotesize{}, linenos, breaklines]{js}{code_examples/http_static_files.js}
\end{code}

\begin{code}
  \captionof{listing}{\label{list:socketio_s} Kód programu web\_ui běžící na~serveru. Ten~příjmá informace pomocí knihovny zeromq.js a~předává je~klientovi pomocí knihovny socket.io.}
  \inputminted[frame=lines,fontsize=\footnotesize{}, linenos, breaklines]{js}{code_examples/socketio_server.js}
\end{code}
\begin{code}
  \captionof{listing}{\label{list:socketio_c} Kód programu web\_ui běžící v~prohlížeči. Ten~příjmá informace od~serveru knihovny socket.io a~zobrazuje je~uživateli kromě jiného pomocí knihovny xterm.js.}
  \inputminted[frame=lines,fontsize=\footnotesize{}, linenos, breaklines]{js}{code_examples/socketio_client.js}
\end{code}

\end{document}
