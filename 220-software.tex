% !TeX root = text.tex
\chapter{Software}

Tato kapitola se~zabývá softwarovou výbavou laserového projektoru. Popisuje klíčové programy, jejich funkce a~způsob, jakým mezi sebou komunikují.
Mezi tyto programy patří program lasershow, který obsluhuje vykreslování, programy pro~interakci s~uživatelem (dále \uv{frontendové programy}) jako UI, web\_ui a~discord\_bot, a~také program wifi\_manager, který spravuje wifi připojení Raspberry Pi.
Programy wifi\_manager a~lasershow se~dají označit za~backendové programy, protože neinteragují s~uživatelem.

V neposlední řadě popisuje také instalační skript, který výrazně zjednodušuje instalaci všech zmíněných programů a~jejich závislostí.

Program lasershow umí číst projekční soubory ve~formátu .ild.
Uživatel může takový soubor vytvořit například v~softwaru Laserworld Showeditor V7~\cite{showeditor} nebo může do~frontendových programů nahrát soubor v~populárním vektorovém formátu .svg a~frontendové programy využijí skript svg2ild.py dostupný~z~\cite{svg2ild}.

% O~řízení galvanometrů se~stará program lasershow, který je~psaný v~jazyce C++ pro~maximální rychlost. Tento program běží na~pozadí a~čeká na~příkazy od~programů určených k~interakci s~uživatelem. Na~tento program se~zaměřuje kapitola lasershow. \fxnote{TODO: odkaz}

% Dále jsou tu~programy, které se~starají o~interakci s~uživatelem. Tyto programy přijímají příkazy od~uživatele a~posílají je~programu lasershow. Navíc od~lasershow získávají výstup, který následně zprostředkovávají uživateli; důkladněji popsáno v~kapitole~\ref{sec:comms}.
% Mezi tyto programy patří programy UI, web\_ui a~discord\_bot. Program UI~spravuje OLED displej, přijímá od~uživatele vstup rotačním enkodérem a~je~psaný v~C++ pro~jednodušší interakci s~hardwarem. Program web\_ui využívá runtime Node.js, ve~kterém je~nenáročné vytvořit http server dostupný z~lokální sítě. \fxnote{(A)?} Program discord\_bot, také využívající Node.js, přijímá příkazy z~chatovací aplikace discord a~je~přístupný i~přes internet.

% Nakonec je~tu~program wifi\_manager, ten~spravuje wifi připojení RPi, je~psaný v~Node.js a~komunikuje s~programy, které interagují s~uživatelem stejně jako program lasershow.

\input{221-comms.tex}

\input{222-backend.tex}

\input{223-frontend.tex}

\section{Instalační skript}
Nedílnou součástí softwarové výbavy projektoru je~instalační skript.
Ten je~psaný v~příkazovém jazyce bash, který odpovídá sekvenci příkazů v~příkazovém řádku.
Instalační skript umožňuje instalaci celého projektu pouze třemi příkazy, viz~ukázka kódu~\ref{list:installcmds}.

\begin{code}
  \captionof{listing}{\label{list:installcmds} Příkazy potřebné k~instalaci projektu}
\begin{minted}[frame=lines,fontsize=\footnotesize,linenos]{shell}
  git clone https://github.com/phuid/laser_projector.git
  cd laser_projector
  bash install.sh
\end{minted}
\end{code}

Instalační skript stáhne a~nainstaluje veškeré závislosti a~knihovny ostatních programů. Stáhne také samotný interpreter Node.js.
Následně zkompiluje programy psané v~C++ a~nainstaluje a~nastaví služby potřebné k~vysílání hotspotu. Poté pomocí manažeru procesů pm2 dostupného z~\cite{pm2} nastaví automatické zapínání ostatních programů a~po~potvrzení uživatelem systém restartuje, aby~provedené změny nabyly efekt.
